{% extends "collab/base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
  {{ structure }}


  <form id="form-import-features" action="./import-features" method="post" enctype="multipart/form-data" class="ui form">
    {% csrf_token %}
    <div class="field">
      <label>toto</label>
      <label class="ui icon button" for="json_file">
        <i class="file icon"></i>
        <span class="label">SÃ©lectionner une image ...</span>
      </label>
      <input type="file" accept="application/json, .json" style="display:none;"
        name="json_file" id="json_file">
    </div>
    <button type="submit" class="ui basic teal icon button"></i>Lancer l'import</button>
  </form>
{% endblock %}

{% block custom_resources %}
<script type="text/javascript">
  function truncate(n, len) {
    var ext = n.substring(n.lastIndexOf(".") + 1, n.length).toLowerCase()
    var filename = n.replace('.' + ext, '')
    if (filename.length <= len) {
      return n
    }
    filename = filename.substr(0, len) + (n.length > len ? '[...]' : '')
    return filename + '.' + ext
  }

  $(document).on('change', 'form [name=json_file]', function () {
    var logoFile = $(this).prop('files')[0]
    $(this).parent().children('label').children('.label').html(truncate(logoFile.name, 30))
  })
</script>
{% endblock %}
