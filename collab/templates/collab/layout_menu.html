{% load static %}
{% load app_filters %}
<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>{% block title %}{% endblock %}</title>

  <!-- jQuery Core 3.3.1 -->
  <script src="{% static 'collab/resources/jquery-3.3.1/jquery-3.3.1.min.js'%}"></script>
  <!-- Semantic UI -->
  <link rel="stylesheet" href="{% static 'collab/resources/semantic-ui-2.4.0/semantic.min.css' %}" />
  <script src="{% static 'collab/resources/semantic-ui-2.4.0/semantic.min.js' %}"></script>
  <script src="{% static 'collab/js/project.js' %}"></script>

  <!-- DataTables -->
  <link rel="stylesheet" href="{% static 'collab/resources/DataTables-1.10.18/datatables.min.css' %}" />
  <script src="{% static 'collab/resources/DataTables-1.10.18/datatables.min.js' %}"></script>

  <!-- Mapbox Gl JS -->
  <link rel="stylesheet" href="{% static 'collab/resources/mapbox-gl-0.53.1/mapbox-gl.css' %}" />
  <script src="{% static 'collab/resources/mapbox-gl-0.53.1/mapbox-gl.js' %}"></script>

  <!--STYLE CSS -->
  <link rel="stylesheet" type="text/css" href="{% static 'collab/css/site.css' %}" />
  <link rel="stylesheet" type="text/css" href="{% static 'collab/css/table.css' %}" />
</head>

<body>
  <div class="ui fixed inverted menu">
    <div class="ui container">
      <a href="{% url 'collab:index' %}" class="header item">
        <img id="menu-logo" class="logo" src="{% static 'collab/img/logo.png' %}">
        Collab{% if project %}&nbsp;- {{project.title}}{% endif %}
      </a>
      <div class="right menu">
        {% if request.user.is_authenticated %}
        <div class="item">[{{user.username}}]</div>
        {% endif %}
        <a href="{% url 'collab:help' %}" class="item">Aide</a>
        {% if request.user.is_authenticated %}
        <a href="{% url 'collab:my_account' %}" class="item">Mon compte</a>
        <a href="{% url 'collab:logout' %}" class="item">Se Déconnecter</a>
        {% else %}
        <a href="{% url 'collab:login' %}" class="item">Se Connecter</a>
        {% endif %}
      </div>
    </div>
  </div>
  <div class="ui main container">
    <div class="ui top aligned centered grid container">
      <div class="four wide column left aligned">
        {% block menu %}
        <div class="item">
          {% if project.thumbnail and permissions|lookup:'can_view_project' %}
          <img class="ui small image" src="{{project.thumbnail.url}}" height="200">
          {% endif %}
        </div>
        <div class="ui medium vertical menu">
          <div class="item">
            <div class="header">Accueil</div>
            <div class="menu">
              <a class="item" href="{% url 'collab:index' %}">
                <i class="icon home"></i>Page d'accueil</a>
            </div>
          </div>


          <div class="item">
            <div class="header">Signalements</div>
            <div class="menu">

              {% if project and permissions|lookup:'can_view_feature' %}
              <a class="item" href="{% url 'collab:feature_list' slug=project.slug %}">
                <i class="icon list"></i>Liste</a>
              <a class="item" href="{% url 'collab:project_map' slug=project.slug %}">
                <i class="icon map"></i>Carte</a>
              {% else %}
              <a class="item isDisabled" href="#" ><i class="icon list"></i>Liste</a>
              <a class="item isDisabled" href="#" ><i class="icon map"></i>Carte</a>
              {% endif %}

              {% if project and feature_types and permissions|lookup:'can_create_feature' %}
              <div class="ui simple dropdown item">
                <i class="dropdown icon"></i>
                Ajout d'un signalement
                <div class="menu" id="add_feature_dropdown">
                  <div class="header">Pour :</div>
                  {% for feature_type in feature_types %}
                    <a class="item" href="{% url 'collab:feature_create' slug=project.slug feature_type_slug=feature_type.slug %}">{{feature_type.title}}</a>
                  {% endfor %}
                </div>
              </div>
              {% else %}
              <a class="item isDisabled" href="#" ><i class="dropdown icon"></i>Ajout d'un signalement</a>
              {% endif %}

              {% if project and permissions|lookup:'can_create_feature_type' %}
              <a class="item" href="{% url 'collab:feature_type_create'  slug=project.slug  %}">
              <i class="icon plus"></i>Créer un nouveau type de signalement</a>
              {% endif %}

            </div>
          </div>
          <div class="item">
            <div class="header">Import et export</div>
            <div class="menu">
              <a class="item" href="#">
                <i class="icon upload"></i>Importer en masse...
              </a>
              <a class="item" href="#">
                <i class="icon camera"></i>Importer une photographie...
              </a>

              {% if project and permissions|lookup:'can_view_feature' %}
              <a class="item" href="{% url 'api:project-export' slug=project.slug%}">
                <i class="icon download"></i>Télécharger...
              </a>
              {% endif %}

            </div>
          </div>
          {% if project and permissions|lookup:'can_view_project' %}
          <div class="item">
            <div class="header">Projet</div>
            <div class="menu">
              {% if project %}
              <a class="item" href="{% url 'collab:project' slug=project.slug  %}">
                {% else %}
                <a class="item" href="#">
                  {% endif %}
                  <i class="icon home"></i>Page d'accueil du projet</a>
                <a class="item"><i class="icon lock open"></i>Changer son niveau d'autorisation</a>
                {% if permissions|lookup:'can_create_project' %}
                <a class="item" href="{% url 'collab:project_create'  %}">
                  <i class="icon plus"></i>Créer un nouveau projet</a>
                {% endif %}
                {% if permissions|lookup:'is_project_administrator' %}
                <a class="item" href="{% url 'collab:project_members' slug=project.slug  %}">
                  <i class="icon users"></i>Administrer les membres</a>
                {% endif %}
            </div>
          </div>
          {% endif %}
        </div>
        {% endblock %}
      </div>
      <div class="twelve wide column">
        {% block content %}
        {% endblock %}
      </div>

    </div>

  </div>
  <!-- BRICOLAGE A AMELIORER !!!!!! -->
  <div class="ui sixteen wide column" style="height:100px">
    <div>
      <footer class="ui bottom fixed inverted menu footer">
        <div class="ui center aligned container">
          <div class="ui horizontal inverted small divided link list">
            <a class="item" href="{% url 'collab:legal' %}">Mentions légales</a>
          </div>
        </div>
      </footer>
</body>

</html>
