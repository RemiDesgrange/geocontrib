
<form id="modify_feature" class='ui equal width form modify_feature' method="POST" >
    {% csrf_token %}
    <div class="ui error message"></div>
    <button id="btn_feature_save" type="submit" class="green ui compact icon button">
      <i class="white large save icon"></i>
    </button>
    {% for key,val in feature.items %}
        {% if key|display_key%}
               {% if val.type == 'geometry' %}
                   <div class="field" class='geomfield'>
                        <label>GÃ©ometrie de type  {{geom_type}}</label><br>
                        <input type="text"  name="geom" placeholder="Point(0 25)" value="{{val.value}}" />
                   </div>
               {% elif val.type == 'varchar' and val.choices %}
                   <div class="field">
                       <label>{{labels|get_dict_item:val.column_name}}</label>
                       <div class="ui selection dropdown status">
                           <input type="hidden"  name="{{val.column_name}}" placeholder="{{labels|get_dict_item:val.column_name}}" value="{{val.value}}" />
                           <i class="dropdown icon"></i>
                           <div class="default text"></div>
                           <div class="menu">
                           {% for status in val.choices %}
                               <div class="item" data-value={{status.0}}>{{status.1}}</div>
                           {% endfor %}
                           </div>
                       </div>
                   </div>
                {% elif val.type == 'varchar' %}
                    <div class="field">
                        <label>{{labels|get_dict_item:val.column_name}}</label>
                        <input type="text" maxlength="{{val.char_max_size}}" placeholder="{{labels|get_dict_item:val.column_name}}" name="{{val.column_name}}" value="{{val.value}}" />
                    </div>
                {% elif val.type == 'timestamptz' or val.type == 'date'%}
                     <div class="field">
                        <label>{{labels|get_dict_item:val.column_name}}</label>
                        <div class="ui input left icon">
                            <i class="calendar icon"></i>
                            <input type="text"  name="{{val.column_name}}" placeholder="10/10/2019" value="{{val.value|date:'d/m/Y'}}" />
                        </div>
                     </div>
                {% elif val.type == 'text' %}
                     <div class="field">
                        <label>{{labels|get_dict_item:val.column_name}}</label>
                        <textarea name="{{val.column_name}}" value="{{val.value}}">{{val.value}}</textarea>
                    </div>
                {% elif val.data_type == 'boolean' %}
                     <div class="inline field">
                        <div class="ui checkbox boolfield">
                            {% if val.value %}
                                <input type="checkbox" checked='' name="{{val.column_name}}" class="hidden" >
                            {% else %}
                                <input type="checkbox" unchecked='' name="{{val.column_name}}" class="hidden" >
                            {% endif %}
                            <label>{{labels|get_dict_item:val.column_name}}</label>
                        </div>
                    </div>
                {% elif val.data_type == 'integer' %}
                     <div class="field">
                        <label>{{labels|get_dict_item:val.column_name}}</label>
                        <input type="number" placeholder="{{labels|get_dict_item:val.column_name}}" value="{{val.value}}" name="{{val.column_name}}" />
                    </div>
                {% elif val.data_type == 'double precision' %}
                     <div class="field">
                        <label>{{labels|get_dict_item:val.column_name}}</label>
                        <input type="number" step="any" placeholder="{{labels|get_dict_item:val.column_name}}" value="{{val.value|stringformat:"f" }}" name="{{val.column_name}}" />
                    </div>
                {% endif %}
        {% endif %}
    {% endfor %}
    <div class="field">
       <label>Utilisateur</label>
       <input type="text"  value="{{utilisateur}}"  readonly />
   </div>
</form>

<script>
    // modify feature
    $('.ui.selection.dropdown.status')
      .dropdown()

   function check_form(){
      $('#modify_feature')
       .form({
         fields: {
           title:  {
             identifier: 'title',
             rules: [
               {
                 type   : 'empty',
                 prompt : 'Veuillez entrer un titre pour ce signalement'
               }
             ]
           },
           geom:  {
             identifier: 'geom',
             rules: [
               {
                 type   : 'empty',
                 prompt : 'Veuillez localiser ce signalement'
               }
             ]
           },
           deletion_date: {
             identifier: 'deletion_date',
             optional: true,
             rules: [{
               type:  "regExp[/^(0[1-9]|[12][0-9]|3[01])[/.](0[1-9]|1[012])[/.](19|20)\\d\\d$/]",
               prompt: "Veuiller enter une date valide JJ/MM/AAAA"
             }]
           },
           archive_date: {
             identifier: 'archive_date',
             optional: true,
             rules: [{
               type:  "regExp[/^(0[1-9]|[12][0-9]|3[01])[/.](0[1-9]|1[012])[/.](19|20)\\d\\d$/]",
               prompt: "Veuiller enter une date valide JJ/MM/AAAA"
             }]
           },
         }
       });
    }
    check_form()

  //   $('#modify_feature').submit(function(e){
  //     if( $('#modify_feature').form('is valid')) {
  //         e.preventDefault();
  //         e.stopImmediatePropagation();
  //         url = ''
  //         $.ajax({
  //           url: url,
  //           type: 'POST',
  //           processData: false,
  //           contentType: false,
  //           data: new FormData( this ),
  //           success: function (result) {
  //               $('#edit_feature').html("");
  //               $('#feature_detail').html(result);
  //           },
  //           error: function(err) {
  //             console.log('Error occured', err);
  //           }
  //         });
  //     }
  //  });



</script>
