{% extends "collab/layout_menu.html" %}
{% load app_filters %}
{% block title %}
{{ title }}
{% endblock %}
{% block content %}
{% if rights.feat_creation %}

  {% if success or error %}
      {% if success %}
          <div class="ui success message">
              <div id="success" class="header">{{success}}</div>
          </div>
      {% elif error %}
          <div class="ui error message">
              <div class="header">{{error}}</div>
          </div>
      {% endif %}
  {% else %}
      {% if features_types %}
          <div class="ui middle aligned stackable grid container">
              <div class="row">
                  <h2 class="ui header">{{project.title}}</h2>
              </div>
              <div class="row">
                  <form id="addfeature" class='ui equal width form add_feature' method="POST" >
                    {% csrf_token %}
                    <div class="ui error message"></div>
                    <div class="field">
                        <label>Type de signalement </label>
                        <div class="ui selection dropdown feature" id='feature_type'>
                            <input type="hidden"  name="feature" placeholder="" value="{{features_types.0}}" />
                            <i class="dropdown icon"></i>
                            <div class="default text">Choisissez un type de signalement</div>
                             <div class="menu">
                              {% for elt in features_types %}
                                  <div class="item" data-value={{elt}} >{{elt}}</div>
                              {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div id="create_feature">
                          {% include 'collab/feature/create_feature.html' %}
                    </div>
                 </form>
              </div>
          </div>
      {% else %}
          <div class="header">Aucun type de signalement n'a été créé pour ce projet. Veuillez en créer un.</div>
      {% endif %}
  {% endif %}
{% else %}
  <i class='icon exclamation triangle'></i>
  <span>Vous ne disposez pas des droits nécessaires.</span>
{% endif %}

<script type="text/javascript">

  $('.ui.selection.dropdown.feature')
    .dropdown()
  ;
  // update form regarding the feature choosen
  $("#feature_type").change(function () {
        name = $("input[name=feature]").val();
        url = ''
        $.ajax({
          url: url,
          type: 'GET',
          data:{
            name: name
          },
          success: function (result) {
             $('#create_feature').html(result);
          },
          error: function(err) {
            console.log('Error occured', err);
          }
        });

  });

</script>
{% endblock %}
